<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>اپلیکیشن هواشناسی ایران</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-200 to-blue-500 min-h-screen flex flex-col items-center p-6">

<h1 class="text-3xl font-bold text-white mb-2">اپلیکیشن هواشناسی ایران</h1>
<p id="datetime" class="text-white mb-6"></p>

<div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-3xl">
<label class="block mb-2 font-semibold">استان و شهر را انتخاب کنید:</label>
<select id="citySelect" class="w-full p-2 border rounded mb-4">
<option value="">-- انتخاب شهر --</option>
</select>

<button onclick="getWeather()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition mb-4">نمایش آب‌وهوا</button>

<div id="weatherResult" class="mt-6 hidden">
  <h2 class="text-xl font-bold mb-2">وضعیت فعلی</h2>
  <div id="currentWeather" class="p-4 bg-blue-100 rounded-lg mb-4"></div>

  <h2 class="text-xl font-bold mb-2">پیش‌بینی ۵ روز آینده</h2>
  <div id="forecast" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
</div>

<div class="mt-6">
  <h2 class="text-xl font-bold mb-2">ثبت نظر شما</h2>
  <input id="commentInput" type="text" placeholder="نظر خود را بنویسید..." class="w-full p-2 border rounded mb-2">
  <button onclick="addComment()" class="bg-green-600 text-white px-4 py-2 rounded-lg mb-2">ارسال</button>
  <div id="commentsList" class="mt-4 space-y-2"></div>
</div>
</div>

<footer class="mt-8 text-white font- 
 ساخته شده توسط ابوالفضل شاهمیرزایی سال ۱۴۰۴ 
  این سایت آب و هوا شناسی شامل استان ها و شهرهای مهم ایران است
</footer>

<script>
// ------------------ تاریخ و ساعت زنده ------------------
setInterval(() => {
  const now = new Date();
  document.getElementById("datetime").innerText = now.toLocaleString('fa-IR');
}, 1000);

// ------------------ داده های استان‌ها و شهرها ------------------
const iranProvinces = {
  "آذربایجان شرقی":["تبریز","مراغه","مرند","بناب","میانه","اهر","سراب"],
  "آذربایجان غربی":["ارومیه","خوی","مهاباد","بوکان","پیرانشهر","میاندوآب","سردشت"],
  "اردبیل":["اردبیل","پارس‌آباد","خلخال","مشگین‌شهر","نمین","بیله‌سوار"],
  "اصفهان":["اصفهان","کاشان","نجف‌آباد","شهرضا","مبارکه","گلپایگان","نطنز"],
  "البرز":["کرج","طالقان","نظرآباد","هشتگرد","اشتهارد","فردیس","ماهدشت"],
  "ایلام":["ایلام","دهلران","مهران","آبدانان","ایوان","دره‌شهر","سرابله"],
  "بوشهر":["بوشهر","برازجان","کنگان","جم","گناوه","دشتی","دیر"],
  "تهران":["تهران","شهریار","اسلام‌شهر","ملارد","پاکدشت","ورامین","دماوند"],
  "چهارمحال و بختیاری":["شهرکرد","بروجن","لردگان","فرخشهر","سامان","هفشجان","کیار"],
  "خراسان جنوبی":["بیرجند","قائن","فردوس","سرایشه","طبس","نهبندان","بشرویه"],
  "خراسان رضوی":["مشهد","نیشابور","سبزوار","تربت‌حیدریه","بردسکن","فردوس","گناباد"],
  "خراسان شمالی":["بجنورد","شیروان","اسفراین","جاجرم","مانه","فاروج","راز"],
  "خوزستان":["اهواز","دزفول","آبادان","اندیمشک","خرمشهر","ماهشهر","بهبهان"],
  "زنجان":["زنجان","ابهر","خرمدره","قیدار","هیدج","سلطانیه","زرین‌رود"],
  "سمنان":["سمنان","شاهرود","دامغان","گرمسار","مهدی‌شهر","آرادان","سرخه"],
  "سیستان و بلوچستان":["زاهدان","زابل","ایرانشهر","چابهار","خاش","سراوان","نیک‌شهر"],
  "فارس":["شیراز","مرودشت","جهرم","فسا","لار","کازرون","داراب"],
  "قزوین":["قزوین","تاکستان","الوند","محمدیه","آبیک","بویین‌زهرا","اقبالیه"],
  "قم":["قم","جعفریه","کهک","سلفچگان","دستجرد","قنوات","کوشک نصرت"],
  "کردستان":["سنندج","سقز","مریوان","بانه","قروه","کامیاران","دیواندره"],
  "کرمان":["کرمان","سیرجان","رفسنجان","جیرفت","بم","زرند","کهنوج"],
  "کرمانشاه":["کرمانشاه","اسلام‌آباد غرب","کنگاور","سنقر","هرسین","صحنه","جوانرود"],
  "کهگیلویه و بویراحمد":["یاسوج","دهدشت","گچساران","لیکک","باشت","چرام","سی‌سخت"],
  "گلستان":["گرگان","گنبد کاووس","علی‌آباد کتول","بندر ترکمن","آزادشهر","کردکوی","کلاله"],
  "گیلان":["رشت","بندر انزلی","لاهیجان","لنگرود","رودسر","آستارا","صومعه‌سرا"],
  "لرستان":["خرم‌آباد","بروجرد","دورود","کوهدشت","الشتر","نورآباد","ازنا"],
  "مازندران":["ساری","بابل","آمل","قائم‌شهر","بهشهر","نوشهر","چالوس"],
  "مرکزی":["اراک","ساوه","خمین","محلات","دلیجان","تفرش","آشتیان"],
  "هرمزگان":["بندرعباس","میناب","دهبارز","قشم","کیش","بندر لنگه","حاجی‌آباد"],
  "همدان":["همدان","ملایر","نهاوند","اسدآباد","تویسرکان","کبودرآهنگ","رزن"],
  "یزد":["یزد","میبد","اردکان","بافق","مهریز","تفت","ابرکوه"]
};

// ------------------ پر کردن select با استان‌ها و شهرها ------------------
const select = document.getElementById("citySelect");
for(const province in iranProvinces){
  const optgroup = document.createElement("optgroup");
  optgroup.label = province;
  iranProvinces[province].forEach(city=>{
    const option = document.createElement("option");
    option.value = city;
    option.textContent = city;
    optgroup.appendChild(option);
  });
  select.appendChild(optgroup);
}

// ------------------ API OpenWeatherMap ------------------
const apiKey = "271b621b86d950260e769f30b1e2e86a" ; // جایگزین کنید

async function getWeather(){
  const city = select.value;
  if(!city) return alert("لطفا یک شهر انتخاب کنید.");
  try{
    const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city},IR&appid=${apiKey}&units=metric&lang=fa`);
    const weatherData = await weatherRes.json();
    document.getElementById("currentWeather").innerHTML = `
      <p><strong>دما:</strong> ${weatherData.main.temp}°C</p>
      <p><strong>شرایط:</strong> ${weatherData.weather[0].description}</p>
      <p><strong>رطوبت:</strong> ${weatherData.main.humidity}%</p>
    `;
    const forecastRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city},IR&appid=${apiKey}&units=metric&lang=fa`);
    const forecastData = await forecastRes.json();
    let forecastHTML = "";
    forecastData.list.filter((item,index)=>index%8===0).forEach(day=>{
      const date = new Date(day.dt*1000);
      forecastHTML += `
      <div class="bg-white shadow rounded-lg p-3 text-center">
        <p class="font-bold">${date.toLocaleDateString('fa-IR')}</p>
        <p>${day.main.temp}°C</p>
        <p>${day.weather[0].description}</p>
      </div>`;
    });
    document.getElementById("forecast").innerHTML = forecastHTML;
    document.getElementById("weatherResult").classList.remove("hidden");
  }catch{
    alert("خطا در دریافت اطلاعات از سرور");
  }
}

// ------------------ ذخیره و نمایش نظرات ------------------
function loadComments(){
  const comments = JSON.parse(localStorage.getItem("comments")||"[]");
  const commentsList = document.getElementById("commentsList");
  commentsList.innerHTML="";
  comments.forEach(c=>{
    const div = document.createElement("div");
    div.className="bg-gray-100 p-2 rounded";
    div.innerText = c;
    commentsList.appendChild(div);
  });
}

function addComment(){
  const input = document.getElementById("commentInput");
  const comment = input.value.trim();
  if(!comment) return;
  const comments = JSON.parse(localStorage.getItem("comments")||"[]");
  comments.push(comment);
  localStorage.setItem("comments",JSON.stringify(comments));
  input.value="";
  loadComments();
}

loadComments();
</script>

</body>
</html>

